<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAdmin admin@yourdomain.com
    DocumentRoot /home/ams/amscams/pipeline
    RewriteEngine On

    RewriteCond %{REQUEST_URI} !^/static
    RewriteRule \.(jpg|js|css|html|mp4|svg)$ /static%{REQUEST_URI} [L,R=302]

    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f [OR]
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -d
    RewriteRule ^ - [L]  # Serve directly if existing file or directory

    WSGIDaemonProcess flaskAdmin python-path=/home/ams/amscams/pipeline:/home/ams/.pyenv/versions/3.12.3/lib/python3.12/site-packages
    WSGIScriptAlias / /home/ams/amscams/pipeline/flaskAdmin.wsgi

    Alias /static /mnt/ams2

    <Directory /mnt/ams2>
        Options -Indexes +FollowSymLinks
        Require all granted
    </Directory>

    <Directory /home/ams/amscams/pipeline>
        Options All FollowSymLinks
        AuthType Basic
        AuthName "Restricted Access"
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/flaskAdmin_error.log
    LogLevel warn
    CustomLog ${APACHE_LOG_DIR}/flaskAdmin_access.log combined
</VirtualHost>

